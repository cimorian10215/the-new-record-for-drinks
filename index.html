<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹æ–çµ±è¨ˆ 2026 é›²ç«¯ç‰ˆ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-orange-50 min-h-screen">
    <div id="root">
        <!-- åˆå§‹è®€å–ç‹€æ…‹ï¼Œå¦‚æœ JS æ²’è·‘èµ·ä¾†æœƒçœ‹åˆ°é€™å€‹ -->
        <div class="flex h-screen items-center justify-center">
            <div class="text-center">
                <div class="text-4xl mb-4">ğŸ§‹</div>
                <p class="text-slate-500 font-bold animate-pulse">ç¨‹å¼è¼‰å…¥ä¸­ï¼Œè‹¥é•·æ™‚é–“ç„¡åæ‡‰è«‹æª¢æŸ¥ Firebase é…ç½®...</p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK (ä½¿ç”¨ç›¸å®¹ç‰ˆæœ¬ä»¥ç¢ºä¿ GitHub Pages ç©©å®šæ€§) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- å‹™å¿…å¡«å…¥ä½ è‡ªå·±çš„ Firebase é…ç½® ---
        const firebaseConfig = {
            apiKey: "AIzaSyAN6cKHHdtmSspoA9tOxH9VnWhczImhOlQ",
            authDomain: "the-new-record-for-drinks.firebaseapp.com",
            projectId: "the-new-record-for-drinks",
            storageBucket: "the-new-record-for-drinks.firebasestorage.app",
            messagingSenderId: "661434625679",
            appId: "1:661434625679:web:abe48c7a229e59a3334afa"
        };

        // å°‡ Firebase å¯¦ä¾‹æ›è¼‰åˆ° window è®“ä¸‹æ–¹ React è…³æœ¬å¯ä»¥ä½¿ç”¨
        try {
            const app = initializeApp(firebaseConfig);
            window.fbAuth = getAuth(app);
            window.fbDb = getFirestore(app);
            window.fbMethods = { doc, setDoc, onSnapshot, signInAnonymously, onAuthStateChanged };
            console.log("Firebase Initialized");
        } catch (e) {
            console.error("Firebase Init Error:", e);
            document.getElementById('root').innerHTML = `<div class="p-10 text-red-500 font-bold">Firebase åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key æ˜¯å¦æ­£ç¢ºã€‚</div>`;
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [user, setUser] = useState(null);
            const [records, setRecords] = useState({});
            const [loading, setLoading] = useState(true);
            const [modalOpen, setModalOpen] = useState(false);
            const [selectedDate, setSelectedDate] = useState('');
            const [statusMsg, setStatusMsg] = useState('');

            const iceOptions = ['æ­£å¸¸', 'å°‘å†°', 'å¾®å†°', 'å»å†°', 'å¸¸æº«', 'æº«', 'å›ºå®š'];
            const sugarOptions = ['å…¨ç³–', 'å°‘ç³–', 'åŠç³–', 'å¾®ç³–', 'ä¸€åˆ†', 'ç„¡ç³–', 'å›ºå®š'];
            const defaultEditData = { shop: '', item: '', price: '', ice: 'å°‘å†°', sugar: 'å¾®ç³–', note: '' };
            const [editData, setEditData] = useState(defaultEditData);

            useEffect(() => {
                if (!window.fbAuth) return;
                const { onAuthStateChanged, signInAnonymously } = window.fbMethods;
                
                const unsubscribe = onAuthStateChanged(window.fbAuth, async (u) => {
                    if (!u) {
                        try {
                            await signInAnonymously(window.fbAuth);
                        } catch(e) { console.error("Auth failed", e); }
                    } else {
                        setUser(u);
                    }
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user || !window.fbDb) return;
                const { doc, onSnapshot } = window.fbMethods;
                const docRef = doc(window.fbDb, 'bubble_tea_tracker', user.uid);
                
                const unsubscribe = onSnapshot(docRef, (docSnap) => {
                    if (docSnap.exists()) {
                        setRecords(docSnap.data().records || {});
                    }
                    setLoading(false);
                }, (err) => {
                    console.error("Firestore Error:", err);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [user]);

            const saveToCloud = async (newRecords) => {
                if (!user) return;
                const { doc, setDoc } = window.fbMethods;
                try {
                    const docRef = doc(window.fbDb, 'bubble_tea_tracker', user.uid);
                    await setDoc(docRef, { records: newRecords });
                    setStatusMsg('âœ… å·²åŒæ­¥è‡³é›²ç«¯');
                    setTimeout(() => setStatusMsg(''), 2000);
                } catch (err) {
                    console.error(err);
                }
            };

            const openModal = (date) => {
                setSelectedDate(date);
                setEditData(records[date] || { ...defaultEditData });
                setModalOpen(true);
            };

            const handleSave = () => {
                if (!editData.shop) { alert("è«‹å¡«å¯«åº—å"); return; }
                const newRecords = { ...records, [selectedDate]: editData };
                setRecords(newRecords);
                saveToCloud(newRecords);
                setModalOpen(false);
            };

            const stats = Object.values(records).reduce((acc, r) => {
                acc.totalSpent += (parseInt(r.price) || 0);
                acc.totalCups += 1;
                return acc;
            }, { totalSpent: 0, totalCups: 0 });

            if (loading && !user) return (
                <div className="flex h-screen items-center justify-center font-bold text-orange-400">
                    æ­£åœ¨å˜—è©¦é€£ç·šè‡³ Firebase...
                </div>
            );

            return (
                <div className="p-4 md:p-8 max-w-6xl mx-auto">
                    {statusMsg && (
                        <div className="fixed top-4 right-4 bg-emerald-500 text-white px-6 py-3 rounded-2xl shadow-lg z-50 font-bold animate-bounce">
                            {statusMsg}
                        </div>
                    )}
                    
                    <header className="bg-white p-6 rounded-[2rem] shadow-xl mb-8 flex flex-col md:flex-row justify-between items-center gap-6 border border-orange-100">
                        <div>
                            <h1 className="text-3xl font-black text-slate-800 flex items-center gap-2">ğŸ§‹ æ‰‹æ–çµ±è¨ˆ 2026</h1>
                            <p className="text-slate-400 text-xs font-bold mt-1 uppercase tracking-widest">Cloud Sync Active</p>
                        </div>
                        <div className="flex gap-4 w-full md:w-auto">
                            <div className="flex-1 bg-slate-900 text-white p-4 rounded-2xl text-center min-w-[120px] shadow-lg">
                                <div className="text-[10px] font-black opacity-50 uppercase">Total Spent</div>
                                <div className="text-2xl font-black">${stats.totalSpent}</div>
                            </div>
                            <div className="flex-1 bg-orange-500 text-white p-4 rounded-2xl text-center min-w-[120px] shadow-lg">
                                <div className="text-[10px] font-black opacity-50 uppercase">Total Cups</div>
                                <div className="text-2xl font-black">{stats.totalCups}</div>
                            </div>
                        </div>
                    </header>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        {[0,1,2,3,4,5,6,7,8,9,10,11].map(m => {
                            const days = [];
                            const firstDay = new Date(2026, m, 1).getDay();
                            const totalDays = new Date(2026, m+1, 0).getDate();
                            for(let i=0; i<firstDay; i++) days.push(null);
                            for(let i=1; i<=totalDays; i++) days.push(i);

                            return (
                                <div key={m} className="bg-white p-5 rounded-3xl shadow-sm border border-orange-50">
                                    <h3 className="font-black text-orange-800 mb-3">2026 / {m+1}æœˆ</h3>
                                    <div className="grid grid-cols-7 gap-1 text-[10px] font-bold text-center text-slate-300 mb-2">
                                        <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
                                    </div>
                                    <div className="grid grid-cols-7 gap-1">
                                        {days.map((d, idx) => {
                                            if(!d) return <div key={idx}/>;
                                            const dStr = `2026-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                                            const hasRec = records[dStr];
                                            return (
                                                <div 
                                                    key={dStr} 
                                                    onClick={() => openModal(dStr)} 
                                                    className={`aspect-square flex flex-col items-center justify-center rounded-xl cursor-pointer transition-all hover:scale-110 active:scale-95 border
                                                    ${hasRec ? 'bg-orange-500 border-orange-600 text-white shadow-md shadow-orange-100' : 'border-transparent text-slate-400 hover:bg-orange-50'}`}
                                                >
                                                    <span className="text-xs font-bold">{d}</span>
                                                    {hasRec && <span className="text-[8px] font-black mt-0.5">${hasRec.price}</span>}
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {modalOpen && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                            <div className="bg-white p-8 rounded-[2.5rem] w-full max-w-sm space-y-5 shadow-2xl animate-in fade-in zoom-in duration-200">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-black text-slate-800">{selectedDate}</h2>
                                    <button onClick={()=>setModalOpen(false)} className="text-slate-300 hover:text-slate-500 text-xl">âœ•</button>
                                </div>
                                
                                <div className="space-y-4">
                                    <input type="text" placeholder="åº—å®¶åç¨±" className="w-full p-4 bg-slate-50 rounded-2xl font-bold focus:ring-2 focus:ring-orange-400 outline-none transition-all" value={editData.shop} onChange={e=>setEditData({...editData, shop: e.target.value})}/>
                                    <div className="flex gap-2">
                                        <input type="text" placeholder="å“é …" className="flex-[2] p-4 bg-slate-50 rounded-2xl font-bold focus:ring-2 focus:ring-orange-400 outline-none" value={editData.item} onChange={e=>setEditData({...editData, item: e.target.value})}/>
                                        <input type="number" placeholder="åƒ¹æ ¼" className="flex-1 p-4 bg-slate-50 rounded-2xl font-bold focus:ring-2 focus:ring-orange-400 outline-none" value={editData.price} onChange={e=>setEditData({...editData, price: e.target.value})}/>
                                    </div>
                                    
                                    <div className="space-y-2">
                                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">å†°å¡Š</label>
                                        <div className="grid grid-cols-4 gap-1">
                                            {iceOptions.map(o => (
                                                <button key={o} onClick={()=>setEditData({...editData, ice:o})} className={`py-2 rounded-lg text-[10px] font-bold border-2 transition-all ${editData.ice===o ? 'bg-cyan-500 border-cyan-500 text-white' : 'border-slate-50 text-slate-400 hover:bg-slate-50'}`}>{o}</button>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="space-y-2">
                                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">ç”œåº¦</label>
                                        <div className="grid grid-cols-4 gap-1">
                                            {sugarOptions.map(o => (
                                                <button key={o} onClick={()=>setEditData({...editData, sugar:o})} className={`py-2 rounded-lg text-[10px] font-bold border-2 transition-all ${editData.sugar===o ? 'bg-pink-500 border-pink-500 text-white' : 'border-slate-50 text-slate-400 hover:bg-slate-50'}`}>{o}</button>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                <div className="flex gap-3 pt-4">
                                    <button onClick={handleSave} className="flex-[2] bg-slate-900 text-white py-4 rounded-2xl font-black shadow-xl hover:bg-black active:scale-95 transition-all">ç¢ºèªç´€éŒ„</button>
                                    <button onClick={()=>setModalOpen(false)} className="flex-1 bg-slate-100 text-slate-500 py-4 rounded-2xl font-bold hover:bg-slate-200 transition-all">å–æ¶ˆ</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>