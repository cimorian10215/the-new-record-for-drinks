<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊâãÊêñÁµ±Ë®à 2026 Èõ≤Á´ØÁâà</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-orange-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        // --- ÈáçË¶ÅÔºöË´ãÂú®Ê≠§ËôïÊõøÊèõÊàê‰Ω†Ëá™Â∑±ÁöÑ Firebase ÈÖçÁΩÆ ---
        // ‰Ω†ÂèØ‰ª•Âæû Firebase Console > Â∞àÊ°àË®≠ÂÆö > ÊÇ®ÁöÑÊáâÁî®Á®ãÂºè ‰∏≠ÂèñÂæó
        const firebaseConfig = {
            apiKey: "AIzaSyAN6cKHHdtmSspoA9tOxH9VnWhczImhOlQ",
            authDomain: "the-new-record-for-drinks.firebaseapp.com",
            projectId: "the-new-record-for-drinks",
            storageBucket: "the-new-record-for-drinks.firebasestorage.app",
            messagingSenderId: "G-T97XT0CMWQ",
            appId: "1:661434625679:web:abe48c7a229e59a3334afa"
        };


        const { useState, useEffect } = React;
        
        // ÂãïÊÖãËºâÂÖ• Firebase Ê®°ÁµÑ
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = "bubble-tea-tracker-2026"; // Âõ∫ÂÆöÁöÑ App ID

        function App() {
            const [user, setUser] = useState(null);
            const [records, setRecords] = useState({});
            const [loading, setLoading] = useState(true);
            const [modalOpen, setModalOpen] = useState(false);
            const [selectedDate, setSelectedDate] = useState('');
            const [statusMsg, setStatusMsg] = useState('');

            const iceOptions = ['Ê≠£Â∏∏', 'Â∞ëÂÜ∞', 'ÂæÆÂÜ∞', 'ÂéªÂÜ∞', 'Â∏∏Ê∫´', 'Ê∫´', 'Âõ∫ÂÆö'];
            const sugarOptions = ['ÂÖ®Á≥ñ', 'Â∞ëÁ≥ñ', 'ÂçäÁ≥ñ', 'ÂæÆÁ≥ñ', '‰∏ÄÂàÜ', 'ÁÑ°Á≥ñ', 'Âõ∫ÂÆö'];
            const defaultEditData = { shop: '', item: '', price: '', ice: 'Â∞ëÂÜ∞', sugar: 'ÂæÆÁ≥ñ', note: '' };
            const [editData, setEditData] = useState(defaultEditData);

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, async (u) => {
                    if (!u) {
                        await signInAnonymously(auth);
                    } else {
                        setUser(u);
                    }
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                // Ê≥®ÊÑèÔºöÂú® GitHub ‰ΩøÁî®ÊôÇÔºåË∑ØÂæëÈúÄÁ¨¶Âêà‰Ω†ÁöÑ Firebase Rule Ê¨äÈôê
                const docRef = doc(db, 'bubble_tea_tracker', user.uid);
                
                const unsubscribe = onSnapshot(docRef, (docSnap) => {
                    if (docSnap.exists()) {
                        setRecords(docSnap.data().records || {});
                    }
                    setLoading(false);
                }, (err) => {
                    console.error("Firestore Error:", err);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [user]);

            const saveToCloud = async (newRecords) => {
                if (!user) return;
                try {
                    const docRef = doc(db, 'bubble_tea_tracker', user.uid);
                    await setDoc(docRef, { records: newRecords });
                    setStatusMsg('Èõ≤Á´ØÂêåÊ≠•ÊàêÂäüÔºÅ');
                    setTimeout(() => setStatusMsg(''), 2000);
                } catch (err) {
                    alert('ÂÑ≤Â≠òÂ§±ÊïóÔºö' + err.message);
                }
            };

            const openModal = (date) => {
                setSelectedDate(date);
                setEditData(records[date] || defaultEditData);
                setModalOpen(true);
            };

            const handleSave = () => {
                const newRecords = { ...records, [selectedDate]: editData };
                setRecords(newRecords);
                saveToCloud(newRecords);
                setModalOpen(false);
            };

            const stats = Object.values(records).reduce((acc, r) => {
                acc.totalSpent += (parseInt(r.price) || 0);
                acc.totalCups += 1;
                return acc;
            }, { totalSpent: 0, totalCups: 0 });

            if (loading) return <div className="flex h-screen items-center justify-center font-bold text-orange-400">ËºâÂÖ•‰∏≠...</div>;

            return (
                <div className="p-4 md:p-8 max-w-5xl mx-auto">
                    {statusMsg && <div className="fixed top-4 right-4 bg-slate-800 text-white px-4 py-2 rounded-lg z-50">{statusMsg}</div>}
                    
                    <header className="bg-white p-6 rounded-3xl shadow-lg mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
                        <h1 className="text-2xl font-black text-slate-800 flex items-center gap-2">üßã ÊâãÊêñÁµ±Ë®à 2026</h1>
                        <div className="flex gap-4">
                            <div className="bg-orange-500 text-white p-3 rounded-2xl text-center min-w-[100px]">
                                <div className="text-[10px] font-bold opacity-80">Á∏ΩËä±Ë≤ª</div>
                                <div className="text-xl font-black">${stats.totalSpent}</div>
                            </div>
                            <div className="bg-slate-800 text-white p-3 rounded-2xl text-center min-w-[100px]">
                                <div className="text-[10px] font-bold opacity-80">Á∏ΩÊùØÊï∏</div>
                                <div className="text-xl font-black">{stats.totalCups} ÊùØ</div>
                            </div>
                        </div>
                    </header>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {[0,1,2,3,4,5,6,7,8,9,10,11].map(m => {
                            const days = [];
                            const firstDay = new Date(2026, m, 1).getDay();
                            const totalDays = new Date(2026, m+1, 0).getDate();
                            for(let i=0; i<firstDay; i++) days.push(null);
                            for(let i=1; i<=totalDays; i++) days.push(i);

                            return (
                                <div key={m} className="bg-white p-4 rounded-2xl shadow-sm border border-orange-100">
                                    <h3 className="font-bold text-orange-800 mb-2">2026 / {m+1}Êúà</h3>
                                    <div className="grid grid-cols-7 gap-1 text-[10px] text-center text-slate-300 mb-1">
                                        <div>Êó•</div><div>‰∏Ä</div><div>‰∫å</div><div>‰∏â</div><div>Âõõ</div><div>‰∫î</div><div>ÂÖ≠</div>
                                    </div>
                                    <div className="grid grid-cols-7 gap-1">
                                        {days.map((d, idx) => {
                                            if(!d) return <div key={idx}/>;
                                            const dStr = `2026-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                                            const hasRec = records[dStr];
                                            return (
                                                <div key={dStr} onClick={() => openModal(dStr)} className={`aspect-square flex flex-col items-center justify-center text-xs font-bold rounded-lg cursor-pointer hover:bg-orange-100 ${hasRec ? 'bg-orange-400 text-white' : 'text-slate-400'}`}>
                                                    {d}
                                                    {hasRec && <span className="text-[8px]">${hasRec.price}</span>}
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {modalOpen && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white p-6 rounded-3xl w-full max-w-sm space-y-4">
                                <h2 className="text-xl font-black">{selectedDate}</h2>
                                <input type="text" placeholder="Â∫óÂêç" className="w-full p-3 bg-slate-50 rounded-xl" value={editData.shop} onChange={e=>setEditData({...editData, shop: e.target.value})}/>
                                <input type="text" placeholder="ÂìÅÈ†Ö" className="w-full p-3 bg-slate-50 rounded-xl" value={editData.item} onChange={e=>setEditData({...editData, item: e.target.value})}/>
                                <input type="number" placeholder="ÂÉπÊ†º" className="w-full p-3 bg-slate-50 rounded-xl" value={editData.price} onChange={e=>setEditData({...editData, price: e.target.value})}/>
                                
                                <div className="text-xs font-bold text-slate-400">ÂÜ∞Â°ä</div>
                                <div className="flex flex-wrap gap-1">
                                    {iceOptions.map(o => <button key={o} onClick={()=>setEditData({...editData, ice:o})} className={`px-2 py-1 rounded-md text-[10px] ${editData.ice===o ? 'bg-orange-500 text-white' : 'bg-slate-100'}`}>{o}</button>)}
                                </div>

                                <div className="text-xs font-bold text-slate-400">ÁîúÂ∫¶</div>
                                <div className="flex flex-wrap gap-1">
                                    {sugarOptions.map(o => <button key={o} onClick={()=>setEditData({...editData, sugar:o})} className={`px-2 py-1 rounded-md text-[10px] ${editData.sugar===o ? 'bg-orange-500 text-white' : 'bg-slate-100'}`}>{o}</button>)}
                                </div>

                                <div className="flex gap-2 pt-4">
                                    <button onClick={handleSave} className="flex-1 bg-slate-800 text-white py-3 rounded-xl font-bold">ÂÑ≤Â≠ò</button>
                                    <button onClick={()=>setModalOpen(false)} className="flex-1 bg-slate-100 py-3 rounded-xl font-bold">ÂèñÊ∂à</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>